SET TERM ^ ;

CREATE TRIGGER PRIMANOT_AFTERUPDATE FOR PRIMANOT
ACTIVE AFTER UPDATE POSITION 0
AS
BEGIN

  /* Aggiorna i dati degli allegati del documento */
  UPDATE ALLEGATI A SET 
     A.CODSOGG	= CASE WHEN (A.TIPODOC='Primanota' AND A.NUMDOC=OLD.CODICE AND A.DATADOC=OLD.DATA) THEN NEW.CLIENTE ELSE A.CODSOGG END
    ,A.CODPRAT	= CASE WHEN (A.TIPODOC='Primanota' AND A.NUMDOC=OLD.CODICE AND A.DATADOC=OLD.DATA) THEN NEW.PRATICA ELSE A.CODPRAT END
    ,A.DATAPRAT	= CASE WHEN (A.TIPODOC='Primanota' AND A.NUMDOC=OLD.CODICE AND A.DATADOC=OLD.DATA) THEN NEW.DATAPRATICA1 ELSE A.DATAPRAT END
    ,A.NUMDOC	= NEW.CODICE
    ,A.DATADOC 	= NEW.DATA

  WHERE A.TIPODOC = 'Primanota'
    AND A.NUMDOC  = OLD.CODICE
    AND A.DATADOC = OLD.DATA;

END^

SET TERM ; ^
