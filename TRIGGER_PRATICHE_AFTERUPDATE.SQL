CREATE TRIGGER PRATICHE_AFTERUPDATE FOR PRATICHE
ACTIVE AFTER UPDATE POSITION 0
AS
BEGIN

 IF (NEW.CODICE <> OLD.CODICE OR NEW.DATAAPERTURA <> OLD.DATAAPERTURA) THEN
 BEGIN

  UPDATE ALLEGATI A SET 
    A.CODSOGG = CASE WHEN (A.CODPRAT=OLD.CODICE AND A.DATAPRAT=OLD.DATAAPERTURA) THEN NEW.CLIENTE ELSE A.CODSOGG END,
    A.CODPRAT = NEW.CODICE,
    A.DATAPRAT = NEW.DATAAPERTURA
  WHERE A.CODPRAT = OLD.CODICE
    AND A.DATAPRAT = OLD.DATAAPERTURA;

  UPDATE CONDVEND A SET 
    A.CODPRAT = NEW.CODICE,
    A.DATAPRAT = NEW.DATAAPERTURA
  WHERE A.CODPRAT = OLD.CODICE
    AND A.DATAPRAT = OLD.DATAAPERTURA;

  UPDATE CONFORM A SET 
    A.PRATICA = NEW.CODICE,
    A.DATAPRATICA1 = NEW.DATAAPERTURA
  WHERE A.PRATICA = OLD.CODICE
    AND A.DATAPRATICA1 = OLD.DATAAPERTURA;

  UPDATE CONTATTI A SET 
    A.PRATICA = NEW.CODICE,
    A.DATAPRATICA1 = NEW.DATAAPERTURA
  WHERE A.PRATICA = OLD.CODICE
    AND A.DATAPRATICA1 = OLD.DATAAPERTURA;

  UPDATE DIBATESTATE A SET 
    A.PRATICA = NEW.CODICE,
    A.DATAPRATICA1 = NEW.DATAAPERTURA
  WHERE A.PRATICA = OLD.CODICE
    AND A.DATAPRATICA1 = OLD.DATAAPERTURA;

  UPDATE DIBARIGHI A SET 
    A.PRATICA = NEW.CODICE,
    A.DATAPRATICA1 = NEW.DATAAPERTURA
  WHERE A.PRATICA = OLD.CODICE
    AND A.DATAPRATICA1 = OLD.DATAAPERTURA;

  UPDATE EXTFILE A SET 
    A.PRATICA = NEW.CODICE,
    A.DATAPRATICA1 = NEW.DATAAPERTURA
  WHERE A.PRATICA = OLD.CODICE
    AND A.DATAPRATICA1 = OLD.DATAAPERTURA;

  UPDATE FAX A SET 
    A.PRATICA = NEW.CODICE,
    A.DATAPRATICA1 = NEW.DATAAPERTURA
  WHERE A.PRATICA = OLD.CODICE
    AND A.DATAPRATICA1 = OLD.DATAAPERTURA;

  UPDATE IMPEGNI A SET 
    A.PRATICA = NEW.CODICE,
    A.DATAPRATICA1 = NEW.DATAAPERTURA,
    A.IDPRATICA = NEW.ID
  WHERE A.PRATICA = OLD.CODICE
    AND A.DATAPRATICA1 = OLD.DATAAPERTURA;

  UPDATE PRIMANOT A SET 
    A.PRATICA = NEW.CODICE,
    A.DATAPRATICA1 = NEW.DATAAPERTURA
  WHERE A.PRATICA = OLD.CODICE
    AND A.DATAPRATICA1 = OLD.DATAAPERTURA;

  UPDATE PRVORDCL A SET 
    A.PRATICA = NEW.CODICE,
    A.DATAPRATICA1 = NEW.DATAAPERTURA
  WHERE A.PRATICA = OLD.CODICE
    AND A.DATAPRATICA1 = OLD.DATAAPERTURA;

  UPDATE RIGHIPRV A SET 
    A.PRATICA = NEW.CODICE,
    A.DATAPRATICA1 = NEW.DATAAPERTURA
  WHERE A.PRATICA = OLD.CODICE
    AND A.DATAPRATICA1 = OLD.DATAAPERTURA;

  UPDATE RAPGIORN A SET 
    A.PRATICA = NEW.CODICE,
    A.DATAPRATICA1 = NEW.DATAAPERTURA
  WHERE A.PRATICA = OLD.CODICE
    AND A.DATAPRATICA1 = OLD.DATAAPERTURA;

  UPDATE RAPGIORNRIGHI A SET 
    A.CODCANTIERE = NEW.CODICE,
    A.DATACANTIERE = NEW.DATAAPERTURA
  WHERE A.CODCANTIERE = OLD.CODICE
    AND A.DATACANTIERE = OLD.DATAAPERTURA;

  UPDATE RAPGIORNRIGHISPESE A SET 
    A.CODCANTIERE = NEW.CODICE,
    A.DATACANTIERE = NEW.DATAAPERTURA
  WHERE A.CODCANTIERE = OLD.CODICE
    AND A.DATACANTIERE = OLD.DATAAPERTURA;

  UPDATE SCADENZ A SET 
    A.PRATICA = NEW.CODICE,
    A.DATAPRATICA1 = NEW.DATAAPERTURA
  WHERE A.PRATICA = OLD.CODICE
    AND A.DATAPRATICA1 = OLD.DATAAPERTURA;

  UPDATE SOTTOCANTIERI1 A SET 
    A.CODICECANTIERE = NEW.CODICE,
    A.DATAAPERTURACANTIERE = NEW.DATAAPERTURA
  WHERE A.CODICECANTIERE = OLD.CODICE
    AND A.DATAAPERTURACANTIERE = OLD.DATAAPERTURA;

  UPDATE SOTTOCANTIERI2 A SET 
    A.CODICECANTIERE = NEW.CODICE,
    A.DATAAPERTURACANTIERE = NEW.DATAAPERTURA
  WHERE A.CODICECANTIERE = OLD.CODICE
    AND A.DATAAPERTURACANTIERE = OLD.DATAAPERTURA;

  UPDATE SOTTOCANTIERI3 A SET 
    A.CODICECANTIERE = NEW.CODICE,
    A.DATAAPERTURACANTIERE = NEW.DATAAPERTURA
  WHERE A.CODICECANTIERE = OLD.CODICE
    AND A.DATAAPERTURACANTIERE = OLD.DATAAPERTURA;

  UPDATE TESTI A SET 
    A.PRATICA = NEW.CODICE,
    A.DATAPRATICA1 = NEW.DATAAPERTURA
  WHERE A.PRATICA = OLD.CODICE
    AND A.DATAPRATICA1 = OLD.DATAAPERTURA;

  UPDATE GC_COSTOMEDIO A SET 
    A.PRATICA = NEW.CODICE,
    A.DATAPRATICA = NEW.DATAAPERTURA
  WHERE A.PRATICA = OLD.CODICE
    AND A.DATAPRATICA = OLD.DATAAPERTURA;
    
 END




 
 
 IF (NEW.ID <> OLD.ID) THEN
 BEGIN


  UPDATE PRATAPPARECCHI A SET
    A.IDPRATICA = NEW.ID
  WHERE A.IDPRATICA = OLD.ID;

  UPDATE OPPRATICA A SET
    A.IDPRATICA = NEW.ID
  WHERE A.IDPRATICA = OLD.ID;

  UPDATE OPIMPEGNO A SET
    A.IDPRATICA = NEW.ID
  WHERE A.IDPRATICA = OLD.ID;

 END

END
