SET TERM ^ ;

CREATE TRIGGER SCADENZ_AFTERUPDATE FOR SCADENZ
ACTIVE AFTER UPDATE POSITION 0
AS
BEGIN

  /* Aggiorna i dati degli allegati del documento */
  UPDATE ALLEGATI A SET 
     A.CODSOGG	= CASE WHEN (A.TIPODOC=OLD.TIPO AND A.NUMDOC=OLD.CODICE AND A.DATADOC=OLD.DATASCADENZA) THEN NEW.CLIENTE ELSE A.CODSOGG END
    ,A.CODPRAT	= CASE WHEN (A.TIPODOC=OLD.TIPO AND A.NUMDOC=OLD.CODICE AND A.DATADOC=OLD.DATASCADENZA) THEN NEW.PRATICA ELSE A.CODPRAT END
    ,A.DATAPRAT	= CASE WHEN (A.TIPODOC=OLD.TIPO AND A.NUMDOC=OLD.CODICE AND A.DATADOC=OLD.DATASCADENZA) THEN NEW.DATAPRATICA1 ELSE A.DATAPRAT END
    ,A.NUMDOC	= NEW.CODICE
    ,A.DATADOC 	= NEW.DATASCADENZA

  WHERE A.TIPODOC = OLD.TIPO
    AND A.NUMDOC  = OLD.CODICE
    AND A.DATADOC = OLD.DATASCADENZA;

END^

SET TERM ; ^
