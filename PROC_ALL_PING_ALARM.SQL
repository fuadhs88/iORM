CREATE PROCEDURE ALL_PING_ALARM
  RETURNS (OUTVAR INTEGER)
AS

  DECLARE A CURSOR FOR (SELECT COUNT(*) AS QUANTI FROM ALLEGATI A WHERE A.ALARM_DATAORA <= CURRENT_TIMESTAMP AND A.ALARM_FATTO <> 'T');

BEGIN

  /* Esegue la query che verifica quanti allegati scaduti ci sono */
  OPEN A;
  FETCH A INTO :OUTVAR;
  CLOSE A;
  SUSPEND;
  EXIT;

END
