/* View: GOS_ORE, Owner: 1DR0GAT3 */

CREATE VIEW GOS_ORE (
  NUMDOC
 ,DATADOC
 ,REGISTRO
 ,NUMRIGO
 ,QTA
 ,COSTOORARIO
 ,IMPORTOCOSTOORARIO
 ,NOTE
 ,TIPOORE1
 ,TIPOORE2
 ,TIPOORE3
 ,TIPO1
 ,TIPO2
 ,TIPO3
 ,TIPO4
 ,TIPO5
 ,TIPO6
 ,AGENTE
 ,AGENTE2
 ,AGENTE3
 ,AGENTE4
 ,PRZVEND
 ,IMPORTOVEND
 ,COSTOSTRAORDINARIO
 ,QTASTRAORDINARIO
 ,IMPORTOSTRAORDINARIO
 ,COSTOPERMESSI
 ,QTAPERMESSI
 ,IMPORTOPERMESSI
 ,COSTOFERIE
 ,QTAFERIE
 ,IMPORTOFERIE
 ,COSTOTRASFERTE
 ,QTATRASFERTE
 ,IMPORTOTRASFERTE
 ,OREBASE
 ,DOCUMENTO
 ,DIPENDENTE
 ,CANTIERE
 ,SOGGETTO
 ,OPERAINDEX
 ,SOTTOCANTIERE1
 ,SOTTOCANTIERE2
 ,SOTTOCANTIERE3
 ,CATEGCANT1
 ,CATEGCANT2
 ,CATEGCANT3
 ,CATEGCANT4
 ,CATEGCANT5
 ,CATEGCANT6
 ,TIPODOC
 ,NUMRIGO2
 ,STATODESCRIZIONE
 ,STATOFOREGROUND
 ,STATOBACKGROUND
 ,CODCANTIERE
 ,DATACANTIERE
 ,CODSOGGETTO
 ,CODDIPENDENTE

) AS

  SELECT 
    RO.NUMDOC
   ,RO.DATADOC
   ,RO.REGISTRO
   ,RO.NUMRIGO
   ,RO.QTA
   ,RO.COSTOORARIO
   ,RO.IMPORTOCOSTOORARIO
   ,RO.NOTE
   ,RO.TIPOORE1
   ,RO.TIPOORE2
   ,RO.TIPOORE3
   ,RO.TIPO1
   ,RO.TIPO2
   ,RO.TIPO3
   ,RO.TIPO4
   ,RO.TIPO5
   ,RO.TIPO6
   ,CAST((CASE   WHEN (RO.TIPODOC='Rapp.giorn.') THEN RG.AGENTE    WHEN (RO.TIPODOC='Giornale_cantiere') THEN NULL   ELSE PRV.AGENTE  END)     AS VARCHAR(25)) AS AGENTE
   ,CAST((CASE   WHEN (RO.TIPODOC='Rapp.giorn.') THEN RG.AGENTE2   WHEN (RO.TIPODOC='Giornale_cantiere') THEN NULL   ELSE PRV.AGENTE2 END)     AS VARCHAR(25)) AS AGENTE2
   ,CAST((CASE   WHEN (RO.TIPODOC='Rapp.giorn.') THEN RG.AGENTE3   WHEN (RO.TIPODOC='Giornale_cantiere') THEN NULL   ELSE PRV.AGENTE3 END)     AS VARCHAR(25)) AS AGENTE3
   ,CAST((CASE   WHEN (RO.TIPODOC='Rapp.giorn.') THEN RG.AGENTE4   WHEN (RO.TIPODOC='Giornale_cantiere') THEN NULL   ELSE PRV.AGENTE4 END)     AS VARCHAR(25)) AS AGENTE4
   ,RO.PRZVEND
   ,RO.IMPORTOVEND
   ,RO.COSTOSTRAORDINARIO
   ,RO.QTASTRAORDINARIO
   ,RO.IMPORTOSTRAORDINARIO
   ,RO.COSTOPERMESSI
   ,RO.QTAPERMESSI
   ,RO.IMPORTOPERMESSI
   ,RO.COSTOFERIE
   ,RO.QTAFERIE
   ,RO.IMPORTOFERIE
   ,RO.COSTOTRASFERTE
   ,RO.QTATRASFERTE
   ,RO.IMPORTOTRASFERTE
   ,RO.OREBASE
   ,CAST(RO.TIPODOC || ' ' || RO.NUMDOC || RO.REGISTRO || ' del ' || RO.DATADOC AS VARCHAR(80)) AS DOCUMENTO
   ,CAST(RO.DESCRIZDIPENDENTE || '  (' || RO.CODDIPENDENTE || ')' AS VARCHAR(100)) AS DIPENDENTE
   ,CAST(RO.DESCRIZCANTIERE || '  (' || RO.CODCANTIERE || ' del ' || RO.DATACANTIERE || ')' AS VARCHAR(100)) AS CANTIERE
   ,CAST(RO.DESCRIZSOGGETTO || '  (' || RO.CODSOGGETTO || ')' AS VARCHAR(100)) AS SOGGETTO
   ,RO.OPERAINDEX
   ,RO.SOTTOCANTIERE1
   ,RO.SOTTOCANTIERE2
   ,RO.SOTTOCANTIERE3
   ,PRAT.CATEGCANT1
   ,PRAT.CATEGCANT2
   ,PRAT.CATEGCANT3
   ,PRAT.CATEGCANT4
   ,PRAT.CATEGCANT5
   ,PRAT.CATEGCANT6
   ,RO.TIPODOC
   ,RO.NUMRIGO2
   ,CAST((CASE   WHEN (RO.TIPODOC='Rapp.giorn.') THEN RG.STATODESCRIZIONE   WHEN (RO.TIPODOC='Giornale_cantiere') THEN NULL   ELSE PRV.STATODESCRIZIONE END)     AS VARCHAR(10)) AS STATODESCRIZIONE
   ,CAST((CASE   WHEN (RO.TIPODOC='Rapp.giorn.') THEN RG.STATOFOREGROUND   WHEN (RO.TIPODOC='Giornale_cantiere') THEN NULL   ELSE PRV.STATOFOREGROUND END)     AS VARCHAR(10)) AS STATOFOREGROUND
   ,CAST((CASE   WHEN (RO.TIPODOC='Rapp.giorn.') THEN RG.STATOBACKGROUND   WHEN (RO.TIPODOC='Giornale_cantiere') THEN NULL   ELSE PRV.STATOBACKGROUND END)     AS VARCHAR(10)) AS STATOBACKGROUND
   ,RO.CODCANTIERE
   ,RO.DATACANTIERE
   ,RO.CODSOGGETTO
   ,RO.CODDIPENDENTE

  FROM RAPGIORNRIGHI RO
  LEFT JOIN RAPGIORN RG ON (RG.NUMDOC=RO.NUMDOC AND RG.REGISTRO=RO.REGISTRO AND RG.DATADOC=RO.DATADOC)
  LEFT JOIN PRVORDCL PRV ON (PRV.TIPODOCUMENTO=RO.TIPODOC AND PRV.NUMORDPREV=RO.NUMDOC AND PRV.REGISTRO=RO.REGISTRO AND PRV.DATADOCUMENTO=RO.DATADOC)
  LEFT JOIN PRATICHE PRAT ON (PRAT.CODICE=RO.CODCANTIERE AND PRAT.DATAAPERTURA=RO.DATACANTIERE)
;
