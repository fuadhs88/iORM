SET TERM ^ ;

CREATE TRIGGER RAPGIORN_AFTERUPDATE FOR RAPGIORN
ACTIVE AFTER UPDATE POSITION 0
AS
BEGIN

  /* Aggiorna i dati degli allegati del documento */
  UPDATE ALLEGATI A SET 
     A.CODSOGG	= CASE WHEN (A.TIPODOC='Rapp.giorn.' AND A.REGDOC=OLD.REGISTRO AND A.NUMDOC=OLD.NUMDOC AND A.DATADOC=OLD.DATADOC) THEN NEW.CODICECLIENTE ELSE A.CODSOGG END
    ,A.CODPRAT	= CASE WHEN (A.TIPODOC='Rapp.giorn.' AND A.REGDOC=OLD.REGISTRO AND A.NUMDOC=OLD.NUMDOC AND A.DATADOC=OLD.DATADOC) THEN NEW.PRATICA ELSE A.CODPRAT END
    ,A.DATAPRAT	= CASE WHEN (A.TIPODOC='Rapp.giorn.' AND A.REGDOC=OLD.REGISTRO AND A.NUMDOC=OLD.NUMDOC AND A.DATADOC=OLD.DATADOC) THEN NEW.DATAPRATICA1 ELSE A.DATAPRAT END
    ,A.REGDOC	= NEW.REGISTRO
    ,A.NUMDOC	= NEW.NUMDOC
    ,A.DATADOC 	= NEW.DATADOC

  WHERE A.TIPODOC = 'Rapp.giorn.'
    AND A.REGDOC  = OLD.REGISTRO
    AND A.NUMDOC  = OLD.NUMDOC
    AND A.DATADOC = OLD.DATADOC;

END^

SET TERM ; ^
