/* View: SOGG_LIST_VIEW, Owner: 1DR0GAT3 */

CREATE VIEW SOGG_LIST_VIEW (

   CODICE
  ,RagioneSociale
  ,Indirizzo
  ,Citta
  ,CAP
  ,Provincia
  ,DataNascita
  ,LuogoNascita
  ,Telefono
  ,Fax
  ,ClienteFornitore
  ,Cellulare
  ,STATODESCRIZIONE
  ,STATOFOREGROUND
  ,STATOBACKGROUND
  ,PARTITAIVA
  ,CODICEFISCALE
  ,EMAIL
  ,NOTE
  ,AGENTE
  ,AGENTE2
  ,AGENTE3
  ,AGENTE4
  ,PAGAM
  ,ABI
  ,CAB
  ,BANCA
  ,STR_CERTIFIED
  ,EXISTS_PRESCRIZIONI
  ,EXISTS_URGENTI
  ,EXISTS_CHIAMATE
  ,EXISTS_CORRISPNOPAG
  ,EXISTS_SCADSOFF
  ,PA_CODICEDESTINATARIO
  ,PEC
  ,NAZIONESIGLA

) AS

  SELECT

    C.CODICE
   ,CASE WHEN (C.TIPOPERSONA = 'F') THEN CAST(SUBSTRING(COALESCE(C.COGNOME,'') || ' ' || COALESCE(C.NOME,'') FROM 1 FOR 60) AS VARCHAR(60)) ELSE C.RAGIONESOCIALE END
   ,CAST(COALESCE(C.Indirizzo, '') || ' ' || COALESCE(C.NumCivico, '') AS VARCHAR(120)) AS Indirizzo
   ,C.Citta
   ,C.CAP
   ,C.Provincia
   ,C.DataNascita
   ,C.LuogoNascita
   ,C.Telefono
   ,C.Fax
   ,C.ClienteFornitore
   ,C.Cellulare
   ,C.STATODESCRIZIONE
   ,C.STATOFOREGROUND
   ,C.STATOBACKGROUND
   ,C.PARTITAIVA
   ,C.CODICEFISCALE
   ,C.EMAIL
   ,C.NOTE
   ,C.AGENTE
   ,C.AGENTE2
   ,C.AGENTE3
   ,C.AGENTE4
   ,CAST(P.DESCRIZIONE || '   (' || P.CODICE || ')' AS VARCHAR(60)) AS PAGAM
   ,C.ABI
   ,C.CAB
   ,B.BANCA

   ,(SELECT OUTVAR FROM STRADARIO_CERTIFICATO(CODICEISTATCOMUNE,Citta,Indirizzo,Provincia)) AS STR_CERTIFIED

   ,(SELECT OUTVAL FROM SOGG_PRESCRIZ_EXISTS(C.CODICE))       AS EXISTS_PRESCRIZIONI
   ,(SELECT OUTVAL FROM SOGG_URGENTI_EXISTS(C.CODICE))        AS EXISTS_URGENTI
   ,(SELECT OUTVAL FROM SOGG_CHIAMATE_EXISTS(C.CODICE))       AS EXISTS_CHIAMATE
   ,(SELECT OUTVAL FROM SOGG_CORRISPNOPAG_EXISTS(C.CODICE))   AS EXISTS_CORRISPNOPAG
   ,(SELECT OUTVAL FROM SOGG_SCADSOFF_EXISTS(C.CODICE))       AS EXISTS_SCADSOFF

  ,C.PA_CODICEDESTINATARIO
  ,C.PEC
  ,C.NAZIONESIGLA

  FROM Clienti C
  LEFT JOIN PAGAM P ON (P.CODICE = C.PAGAMENTO)
  LEFT JOIN BANCHE B ON (B.ABI=C.ABI AND B.CAB=C.CAB)
  WHERE C.CODICE<>0
;
