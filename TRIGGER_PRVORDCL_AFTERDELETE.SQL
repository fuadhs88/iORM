SET TERM ^ ;

CREATE TRIGGER PRVORDCL_AFTERDELETE FOR PRVORDCL
ACTIVE AFTER DELETE POSITION 0
AS
BEGIN

  /* Elimina gli allegati relativi al documento eliminato */
  DELETE FROM ALLEGATI A  
  WHERE A.TIPODOC = OLD.TIPODOCUMENTO
    AND COALESCE(A.REGDOC,'') = COALESCE(OLD.REGISTRO,'')
    AND NUMDOC  = OLD.NUMORDPREV
    AND A.DATADOC = OLD.DATADOCUMENTO;

  /* Elimina i documenti correlati (F.E.) relativi al documento eliminato */
  DELETE FROM PRVORDCL_DOCCORRELATI DC  
  WHERE DC.TIPODOCUMENTO = OLD.TIPODOCUMENTO
    AND DC.REGISTRO  = OLD.REGISTRO
    AND DC.NUMORDPREV  = OLD.NUMORDPREV
    AND DC.DATADOCUMENTO = OLD.DATADOCUMENTO;

  /* Elimina le notifiche della F.E. */
  DELETE FROM PRVORDCL_FE FE  
  WHERE FE.TIPODOC = OLD.TIPODOCUMENTO
    AND FE.REGDOC  = OLD.REGISTRO
    AND FE.NUMDOC  = OLD.NUMORDPREV
    AND FE.DATADOC = OLD.DATADOCUMENTO;

  /* Elimina le scadenze del documento eliminato */
  DELETE FROM SCADENZ SCAD  
  WHERE SCAD.TIPODOC = OLD.TIPODOCUMENTO
    AND SCAD.REGISTRO  = OLD.REGISTRO
    AND SCAD.NUMDOC  = OLD.NUMORDPREV
    AND SCAD.DATADOC = OLD.DATADOCUMENTO;

END^

SET TERM ; ^
