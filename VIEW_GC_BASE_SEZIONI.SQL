/* 
   =================================================
   Vista che aggiunge la suddivisione degli importi
   nelle varie sezioni di cui è composto il GC
   =================================================
*/

CREATE VIEW GC_BASE_SEZIONI
(
  /* ---------------------------------- */
  /* CAMPI PRESI DALLA VISTA PRECEDENTE */
  /* ---------------------------------- */
   TipoDocumento
  ,NumOrdPrev
  ,Registro
  ,DATADOCUMENTO
  ,PROGRIGO
  ,PROGRIGO2
  ,CAUSALE
  ,CODICECLIENTE

  ,PRATICA
  ,DATAPRATICA1
  ,DATACHIUSURAPRATICA1
  ,STATODESCRIZIONEPRATICA1
  ,RIFPRATICA
  ,CODSOGGPRAT
  ,PRAT_PRZUNITOPERA1_1
  ,PRAT_PRZUNITOPERA1_2
  ,PRAT_PRZUNITOPERA1_3
  ,PRAT_PRZUNITOPERA1_4
  ,PRAT_PRZUNITOPERA1_5
  ,PRAT_TIPORICARICO
  ,PRAT_TIPORICDACOMMESSA
  ,PRAT_RICARICOPERC
  ,PRAT_LISTINO
  ,OPERAINDEX
  ,OPERACODICE
  ,OPERADESCRIZIONE

  ,GUID
  ,GUID_REF
  ,GUID_ANCESTOR
  ,TRACK_PREVENTIVO
  ,TRACK_COMMESSA
  ,TRACK_DDT
  ,TRACK_FATTURA
  ,TRACK_ESTRATTO_CONTO
  ,TRACK_SAL
  ,TRACK_BOLLA_ENTR
  ,TRACK_FATT_ACQUI
  ,TRACK_ORD_FORN

  ,SEGNOOPERAZIONECANTIERE
  ,SEGNOOPERAZIONE
  ,GC_SEZIONE
  ,STATODESCRIZIONE
  ,STATOFOREGROUND

  ,DOCUMENTO
  ,SOGGETTO

  ,CodiceMagazzino
  ,MovMag
  ,CodiceArticolo
  ,Descrizione
  ,PrezzoUnitario
  ,UnitaDiMisura
  ,Qta
  ,ScontoRigo
  ,ScontoRigo2
  ,ScontoRigo3
  ,ImportoRigo
  ,PREZZOACQUISTOARTICOLO
  ,IMPORTOACQUISTOARTICOLO
  ,NOTERIGO
  ,MARGINE
  ,PREZZOUNITARIONETTO
  ,CodiceIVA
  ,DescrizioneIVA
  ,AliquotaIVA

  ,SOTTOCANTIERE1
  ,SOTTOCANTIERE2
  ,SOTTOCANTIERE3
  ,SOTTOCANTIERE4
  ,SOTTOCANTIERE5
  ,SOTTOCANTIERE6

  ,CATEGCANT1
  ,CATEGCANT2
  ,CATEGCANT3
  ,CATEGCANT4
  ,CATEGCANT5
  ,CATEGCANT6

  ,S3RIF
  ,S3UBICAZIONE
  ,S3COMPONENTE
  ,S3MATERIALE
  ,S3QTA
  ,S3DIAMETRO
  ,S3LUNGHEZZA
  ,S3INSTALLAZIONE
  ,S3CERTIFICAZIONE
  ,S3VENTILAZIONE
  ,S3SCARICO
  ,S3TIPO
  ,S3PORTATATERMICA
  ,S3TIPOCOLLEGAMENTO
  ,S3INSTALLATOINSTALLABILE
  ,S3MODELLO

  ,TIPOLOGIA

  ,GC_COSTONETTOUNITARIO_MOD
  ,GC_COSTONETTOUNITARIO
  ,GC_COSTONETTOIMPORTO

  ,GC_RICARICO_MOD
  ,GC_RICARICO
  ,GC_GUADAGNOUNITARIO
  ,GC_GUADAGNOIMPORTO

  ,GC_QTA_MOD
  ,GC_QTA

  ,GC_DESCRIZIONE_MOD
  ,GC_DESCRIZIONE

  ,GC_PRZVEND
  ,GC_PRESENTEINCOMMESSA
  ,GC_PRZVENDDACOMMESSA
  ,GC_PRZVENDIMPORTO

  /* ------------------------------------------------- */
  /* CAMPI AGGIUNTI RELATIVI ALLE VARIE SEZIONI DEL GC
  /* ------------------------------------------------- */
  ,GC_COMMESSA_QTA
  ,GC_COMMESSA_PRZUNITACQ
  ,GC_COMMESSA_IMPORTOACQ
  ,GC_COMMESSA_PRZUNITVEND
  ,GC_COMMESSA_IMPORTOVEND
  ,GC_COMMESSA_RICARICO
  ,GC_COMMESSA_GUADAGNOUNITARIO
  ,GC_COMMESSA_GUADAGNOIMPORTO

  ,GC_CARICO_QTA
  ,GC_CARICO_PRZUNITACQ
  ,GC_CARICO_IMPORTOACQ
  ,GC_CARICO_PRZUNITVEND
  ,GC_CARICO_IMPORTOVEND

  ,GC_SCARICO_QTA
  ,GC_SCARICO_PRZUNITACQ
  ,GC_SCARICO_IMPORTOACQ
  ,GC_SCARICO_PRZUNITVEND
  ,GC_SCARICO_IMPORTOVEND

  ,GC_GIACENZA_QTA
  ,GC_GIACENZA_PRZUNITACQ
  ,GC_GIACENZA_IMPORTOACQ
  ,GC_GIACENZA_PRZUNITVEND
  ,GC_GIACENZA_IMPORTOVEND
  ,GC_GIACENZA_RICARICO
  ,GC_GIACENZA_GUADAGNOUNITARIO
  ,GC_GIACENZA_GUADAGNOIMPORTO

  ,GC_MONTATO_QTA
  ,GC_MONTATO_PRZUNITACQ
  ,GC_MONTATO_IMPORTOACQ
  ,GC_MONTATO_PRZUNITVEND
  ,GC_MONTATO_IMPORTOVEND

  ,GC_FATTURATO_QTA
  ,GC_FATTURATO_PRZUNITACQ
  ,GC_FATTURATO_IMPORTOACQ
  ,GC_FATTURATO_PRZUNITVEND
  ,GC_FATTURATO_IMPORTOVEND
  ,GC_FATTURATO_RICARICO
  ,GC_FATTURATO_GUADAGNOUNITARIO
  ,GC_FATTURATO_GUADAGNOIMPORTO

  ,GC_DAFATTURARE_QTA
  ,GC_DAFATTURARE_PRZUNITACQ
  ,GC_DAFATTURARE_IMPORTOACQ
  ,GC_DAFATTURARE_PRZUNITVEND
  ,GC_DAFATTURARE_IMPORTOVEND
  ,GC_DAFATTURARE_RICARICO
  ,GC_DAFATTURARE_GUADAGNOUNITARIO
  ,GC_DAFATTURARE_GUADAGNOIMPORTO

  ,GC_DDT_QTA
  ,GC_DDT_PRZUNITACQ
  ,GC_DDT_IMPORTOACQ
  ,GC_DDT_PRZUNITVEND
  ,GC_DDT_IMPORTOVEND

  ,GC_DDTRESIDUO_QTA
  ,GC_DDTRESIDUO_PRZUNITACQ
  ,GC_DDTRESIDUO_IMPORTOACQ
  ,GC_DDTRESIDUO_PRZUNITVEND
  ,GC_DDTRESIDUO_IMPORTOVEND
)

AS


/* =================================================
   |   VISTA BASE RIGHI                            |
   =================================================
*/
SELECT

  /* ---------------------------------- */
  /* CAMPI PRESI DALLA VISTA PRECEDENTE */
  /* ---------------------------------- */
   TipoDocumento
  ,NumOrdPrev
  ,Registro
  ,DATADOCUMENTO
  ,PROGRIGO
  ,PROGRIGO2
  ,CAUSALE
  ,CODICECLIENTE

  ,PRATICA
  ,DATAPRATICA1
  ,DATACHIUSURAPRATICA1
  ,STATODESCRIZIONEPRATICA1
  ,RIFPRATICA
  ,CODSOGGPRAT
  ,PRAT_PRZUNITOPERA1_1
  ,PRAT_PRZUNITOPERA1_2
  ,PRAT_PRZUNITOPERA1_3
  ,PRAT_PRZUNITOPERA1_4
  ,PRAT_PRZUNITOPERA1_5
  ,PRAT_TIPORICARICO
  ,PRAT_TIPORICDACOMMESSA
  ,PRAT_RICARICOPERC
  ,PRAT_LISTINO
  ,OPERAINDEX
  ,OPERACODICE
  ,OPERADESCRIZIONE

  ,GUID
  ,GUID_REF
  ,GUID_ANCESTOR
  ,TRACK_PREVENTIVO
  ,TRACK_COMMESSA
  ,TRACK_DDT
  ,TRACK_FATTURA
  ,TRACK_ESTRATTO_CONTO
  ,TRACK_SAL
  ,TRACK_BOLLA_ENTR
  ,TRACK_FATT_ACQUI
  ,TRACK_ORD_FORN

  ,SEGNOOPERAZIONECANTIERE
  ,SEGNOOPERAZIONE
  ,GC_SEZIONE
  ,STATODESCRIZIONE
  ,STATOFOREGROUND

  ,DOCUMENTO
  ,SOGGETTO

  ,CodiceMagazzino
  ,MovMag
  ,CodiceArticolo
  ,Descrizione
  ,PrezzoUnitario
  ,UnitaDiMisura
  ,Qta
  ,ScontoRigo
  ,ScontoRigo2
  ,ScontoRigo3
  ,ImportoRigo
  ,PREZZOACQUISTOARTICOLO
  ,IMPORTOACQUISTOARTICOLO
  ,NOTERIGO
  ,MARGINE
  ,PREZZOUNITARIONETTO
  ,CodiceIVA
  ,DescrizioneIVA
  ,AliquotaIVA

  ,SOTTOCANTIERE1
  ,SOTTOCANTIERE2
  ,SOTTOCANTIERE3
  ,SOTTOCANTIERE4
  ,SOTTOCANTIERE5
  ,SOTTOCANTIERE6

  ,CATEGCANT1
  ,CATEGCANT2
  ,CATEGCANT3
  ,CATEGCANT4
  ,CATEGCANT5
  ,CATEGCANT6

  ,S3RIF
  ,S3UBICAZIONE
  ,S3COMPONENTE
  ,S3MATERIALE
  ,S3QTA
  ,S3DIAMETRO
  ,S3LUNGHEZZA
  ,S3INSTALLAZIONE
  ,S3CERTIFICAZIONE
  ,S3VENTILAZIONE
  ,S3SCARICO
  ,S3TIPO
  ,S3PORTATATERMICA
  ,S3TIPOCOLLEGAMENTO
  ,S3INSTALLATOINSTALLABILE
  ,S3MODELLO

  ,TIPOLOGIA

  ,GC_COSTONETTOUNITARIO_MOD
  ,GC_COSTONETTOUNITARIO
  ,GC_COSTONETTOIMPORTO

  ,GC_RICARICO_MOD
  ,GC_RICARICO 
  ,GC_GUADAGNOUNITARIO
  ,GC_GUADAGNOIMPORTO

  ,GC_QTA_MOD
  ,GC_QTA

  ,GC_DESCRIZIONE_MOD
  ,GC_DESCRIZIONE

  ,GC_PRZVEND
  ,GC_PRESENTEINCOMMESSA
  ,GC_PRZVENDDACOMMESSA
  ,GC_PRZVENDIMPORTO

  /* ------------------------------------------------- */
  /* COMMESSA                                          */
  /* ------------------------------------------------- */
  ,CASE SEGNOOPERAZIONECANTIERE WHEN 'C' THEN GC_QTA 			ELSE 0 END
  ,CASE SEGNOOPERAZIONECANTIERE WHEN 'C' THEN GC_COSTONETTOUNITARIO 	ELSE 0 END
  ,CASE SEGNOOPERAZIONECANTIERE WHEN 'C' THEN GC_COSTONETTOIMPORTO 	ELSE 0 END
  ,CASE SEGNOOPERAZIONECANTIERE WHEN 'C' THEN GC_PRZVEND 		ELSE 0 END
  ,CASE SEGNOOPERAZIONECANTIERE WHEN 'C' THEN GC_PRZVENDIMPORTO 	ELSE 0 END
  ,CASE SEGNOOPERAZIONECANTIERE WHEN 'C' THEN GC_RICARICO 		ELSE 0 END
  ,CASE SEGNOOPERAZIONECANTIERE WHEN 'C' THEN GC_GUADAGNOUNITARIO 	ELSE 0 END
  ,CASE SEGNOOPERAZIONECANTIERE WHEN 'C' THEN GC_GUADAGNOIMPORTO 	ELSE 0 END

  /* ------------------------------------------------- */
  /* CARICO                                            */
  /* ------------------------------------------------- */
  ,CASE SEGNOOPERAZIONECANTIERE WHEN '+' THEN GC_QTA 			ELSE 0 END
  ,CASE SEGNOOPERAZIONECANTIERE WHEN '+' THEN GC_COSTONETTOUNITARIO 	ELSE 0 END
  ,CASE SEGNOOPERAZIONECANTIERE WHEN '+' THEN GC_COSTONETTOIMPORTO 	ELSE 0 END
  ,CASE SEGNOOPERAZIONECANTIERE WHEN '+' THEN GC_PRZVEND 		ELSE 0 END
  ,CASE SEGNOOPERAZIONECANTIERE WHEN '+' THEN GC_PRZVENDIMPORTO 	ELSE 0 END

  /* ------------------------------------------------- */
  /* SCARICO                                           */
  /* ------------------------------------------------- */
  ,CASE SEGNOOPERAZIONECANTIERE WHEN '-' THEN GC_QTA 			ELSE 0 END
  ,CASE SEGNOOPERAZIONECANTIERE WHEN '-' THEN GC_COSTONETTOUNITARIO 	ELSE 0 END
  ,CASE SEGNOOPERAZIONECANTIERE WHEN '-' THEN GC_COSTONETTOIMPORTO 	ELSE 0 END
  ,CASE SEGNOOPERAZIONECANTIERE WHEN '-' THEN GC_PRZVEND 		ELSE 0 END
  ,CASE SEGNOOPERAZIONECANTIERE WHEN '-' THEN GC_PRZVENDIMPORTO 	ELSE 0 END

  /* ------------------------------------------------- */
  /* GIACENZA (PROGRESSIVO)                            */
  /* ------------------------------------------------- */
  ,CASE GC_SEZIONE WHEN 'Giacenza' THEN GC_QTA 				ELSE 0 END
  ,CASE GC_SEZIONE WHEN 'Giacenza' THEN GC_COSTONETTOUNITARIO		ELSE 0 END
  ,CASE GC_SEZIONE WHEN 'Giacenza' THEN GC_COSTONETTOIMPORTO  		ELSE 0 END
  ,CASE GC_SEZIONE WHEN 'Giacenza' THEN GC_PRZVEND 			ELSE 0 END
  ,CASE GC_SEZIONE WHEN 'Giacenza' THEN GC_PRZVENDIMPORTO 		ELSE 0 END
  ,CASE GC_SEZIONE WHEN 'Giacenza' THEN GC_RICARICO 			ELSE 0 END
  ,CASE GC_SEZIONE WHEN 'Giacenza' THEN GC_GUADAGNOUNITARIO 		ELSE 0 END
  ,CASE GC_SEZIONE WHEN 'Giacenza' THEN GC_GUADAGNOIMPORTO  		ELSE 0 END

  /* ------------------------------------------------- */
  /* MONTATO                                           */
  /* ------------------------------------------------- */
  ,CASE SEGNOOPERAZIONECANTIERE WHEN 'M' THEN GC_QTA 			ELSE 0 END
  ,CASE SEGNOOPERAZIONECANTIERE WHEN 'M' THEN GC_COSTONETTOUNITARIO 	ELSE 0 END
  ,CASE SEGNOOPERAZIONECANTIERE WHEN 'M' THEN GC_COSTONETTOIMPORTO 	ELSE 0 END
  ,CASE SEGNOOPERAZIONECANTIERE WHEN 'M' THEN GC_PRZVEND 		ELSE 0 END
  ,CASE SEGNOOPERAZIONECANTIERE WHEN 'M' THEN GC_PRZVENDIMPORTO 	ELSE 0 END

  /* ------------------------------------------------- */
  /* FATTURATO                                         */
  /* ------------------------------------------------- */
  ,CASE SEGNOOPERAZIONECANTIERE WHEN 'F' THEN GC_QTA 			ELSE 0 END
  ,CASE SEGNOOPERAZIONECANTIERE WHEN 'F' THEN GC_COSTONETTOUNITARIO     ELSE 0 END
  ,CASE SEGNOOPERAZIONECANTIERE WHEN 'F' THEN GC_COSTONETTOIMPORTO  	ELSE 0 END
  ,CASE SEGNOOPERAZIONECANTIERE WHEN 'F' THEN GC_PRZVEND 		ELSE 0 END
  ,CASE SEGNOOPERAZIONECANTIERE WHEN 'F' THEN GC_PRZVENDIMPORTO 	ELSE 0 END
  ,CASE SEGNOOPERAZIONECANTIERE WHEN 'F' THEN GC_RICARICO 		ELSE 0 END
  ,CASE SEGNOOPERAZIONECANTIERE WHEN 'F' THEN GC_GUADAGNOUNITARIO 	ELSE 0 END
  ,CASE SEGNOOPERAZIONECANTIERE WHEN 'F' THEN GC_GUADAGNOIMPORTO  	ELSE 0 END

  /* ------------------------------------------------- */
  /* DA FATTURARE (PROGRESSIVO)                        */
  /* ------------------------------------------------- */
  ,CASE WHEN (SEGNOOPERAZIONECANTIERE='+' OR SEGNOOPERAZIONECANTIERE='-') THEN GC_QTA 			WHEN (SEGNOOPERAZIONECANTIERE='F') THEN (0-GC_QTA)			ELSE 0 END
  ,CASE WHEN (SEGNOOPERAZIONECANTIERE='+' OR SEGNOOPERAZIONECANTIERE='-') THEN GC_COSTONETTOUNITARIO    WHEN (SEGNOOPERAZIONECANTIERE='F') THEN GC_COSTONETTOUNITARIO		ELSE 0 END
  ,CASE WHEN (SEGNOOPERAZIONECANTIERE='+' OR SEGNOOPERAZIONECANTIERE='-') THEN GC_COSTONETTOIMPORTO  	WHEN (SEGNOOPERAZIONECANTIERE='F') THEN (0-GC_COSTONETTOIMPORTO)	ELSE 0 END
  ,CASE WHEN (SEGNOOPERAZIONECANTIERE='+' OR SEGNOOPERAZIONECANTIERE='-') THEN GC_PRZVEND 		WHEN (SEGNOOPERAZIONECANTIERE='F') THEN GC_PRZVEND			ELSE 0 END
  ,CASE WHEN (SEGNOOPERAZIONECANTIERE='+' OR SEGNOOPERAZIONECANTIERE='-') THEN GC_PRZVENDIMPORTO 	WHEN (SEGNOOPERAZIONECANTIERE='F') THEN (0-GC_PRZVENDIMPORTO)		ELSE 0 END
  ,CASE WHEN (SEGNOOPERAZIONECANTIERE='+' OR SEGNOOPERAZIONECANTIERE='-') THEN GC_RICARICO 		WHEN (SEGNOOPERAZIONECANTIERE='F') THEN GC_RICARICO			ELSE 0 END
  ,CASE WHEN (SEGNOOPERAZIONECANTIERE='+' OR SEGNOOPERAZIONECANTIERE='-') THEN GC_GUADAGNOUNITARIO 	WHEN (SEGNOOPERAZIONECANTIERE='F') THEN GC_GUADAGNOUNITARIO		ELSE 0 END
  ,CASE WHEN (SEGNOOPERAZIONECANTIERE='+' OR SEGNOOPERAZIONECANTIERE='-') THEN GC_GUADAGNOIMPORTO  	WHEN (SEGNOOPERAZIONECANTIERE='F') THEN (0-GC_GUADAGNOIMPORTO)		ELSE 0 END

  /* ------------------------------------------------- */
  /* DDT                                               */
  /* ------------------------------------------------- */
  ,CASE SEGNOOPERAZIONECANTIERE WHEN 'D' THEN GC_QTA 			ELSE 0 END
  ,CASE SEGNOOPERAZIONECANTIERE WHEN 'D' THEN GC_COSTONETTOUNITARIO 	ELSE 0 END
  ,CASE SEGNOOPERAZIONECANTIERE WHEN 'D' THEN GC_COSTONETTOIMPORTO 	ELSE 0 END
  ,CASE SEGNOOPERAZIONECANTIERE WHEN 'D' THEN GC_PRZVEND 		ELSE 0 END
  ,CASE SEGNOOPERAZIONECANTIERE WHEN 'D' THEN GC_PRZVENDIMPORTO 	ELSE 0 END

  /* ------------------------------------------------- */
  /* DDT RESIDUO (PROGRESSIVO)                         */
  /* ------------------------------------------------- */
  ,CASE WHEN (SEGNOOPERAZIONECANTIERE='+') THEN GC_QTA 			WHEN (SEGNOOPERAZIONECANTIERE='-' OR SEGNOOPERAZIONECANTIERE='D') THEN (0-GC_QTA)			ELSE 0 END
  ,CASE WHEN (SEGNOOPERAZIONECANTIERE='+') THEN GC_COSTONETTOUNITARIO   WHEN (SEGNOOPERAZIONECANTIERE='-' OR SEGNOOPERAZIONECANTIERE='D') THEN GC_COSTONETTOUNITARIO		ELSE 0 END
  ,CASE WHEN (SEGNOOPERAZIONECANTIERE='+') THEN GC_COSTONETTOIMPORTO  	WHEN (SEGNOOPERAZIONECANTIERE='-' OR SEGNOOPERAZIONECANTIERE='D') THEN (0-GC_COSTONETTOIMPORTO)		ELSE 0 END
  ,CASE WHEN (SEGNOOPERAZIONECANTIERE='+') THEN GC_PRZVEND 		WHEN (SEGNOOPERAZIONECANTIERE='-' OR SEGNOOPERAZIONECANTIERE='D') THEN GC_PRZVEND			ELSE 0 END
  ,CASE WHEN (SEGNOOPERAZIONECANTIERE='+') THEN GC_PRZVENDIMPORTO 	WHEN (SEGNOOPERAZIONECANTIERE='-' OR SEGNOOPERAZIONECANTIERE='D') THEN (0-GC_PRZVENDIMPORTO)		ELSE 0 END

FROM GC_BASE_GUADAGNI
