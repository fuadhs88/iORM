SET TERM ^ ;

CREATE PROCEDURE GET_PARAM_FOGLIO_LAVORO (IN_IDPRATICA INTEGER)
RETURNS
(     FL_LOGO_INTESTAZIONE CHAR(1),
      FL_TITOLO CHAR(1),
      FL_DATI_PRESCRIZIONI CHAR(1),
      FL_DATI_CHIAMATA CHAR(1),
      FL_DATI_APPUNTAMENTO CHAR(1),
      FL_DATI_SOGGETTO CHAR(1),
      FL_DATI_SOGGETTO_NOTE CHAR(1),
      FL_DATI_richiedente CHAR(1),
      FL_DATI_IMPIANTO CHAR(1),
      FL_DATI_ABBONAMENTO CHAR(1),
      FL_DATI_IMMOBILE CHAR(1),
      FL_DATI_RESPIMP CHAR(1),
      FL_DATI_PROP_UT_AMM CHAR(1),
      FL_DATI_PROPRIETARIO CHAR(1),
      FL_DATI_UTENTE CHAR(1),
      FL_DATI_INSTALLATORE CHAR(1),
      FL_DATI_IMPIANTO_NOTE CHAR(1),
      FL_DATI_APPARECCHI CHAR(1),
      FL_DATI_APPARECCHI_SEPARATI CHAR(1),
      FL_DATI_OP CHAR(1),
      FL_DATI_OP_SOLODAFARE CHAR(1),
      FL_DATI_PRECEDENTI CHAR(1),
      FL_DATI_NUMULTINTERV INTEGER,
      FL_DATI_RAPPINT CHAR(1),
      FL_DATI_MERCE CHAR(1),
      FL_DATI_ALTRESPESE CHAR(1),
      FL_DATI_FIRME CHAR(1),
      FL_LOGO_PIEDE CHAR(1),
      FL_COPIE INTEGER,

      FL_LABEL_APPUNTAMENTO VARCHAR(30),
      FL_LABEL_CHIAMATA VARCHAR(30),
      FL_LABEL_CLIENTE VARCHAR(30),
      FL_LABEL_RICHIEDENTE VARCHAR(30),
      FL_LABEL_LUOGO VARCHAR(30),
      FL_LABEL_MOTIVO VARCHAR(30),
      FL_LABEL_NOTE VARCHAR(30),

      FL_DATI_INTESTAZFATTURA CHAR(1),

      FL_MESSAGGIO VARCHAR(1000),
      FL_MESSAGGIO_ALTEZZA INTEGER,

      FL_DATI_RAPPINT_NUMRIGHEDATAORA INTEGER,
      FL_DATI_RAPPINT_ALTEZZARELAZINT INTEGER,
      FL_DATI_RAPPINT_STATO CHAR(1)
)
AS
      DECLARE IMP_FL_USAPREDEFINITI CHAR(1);
BEGIN
  /* Prima di tutto prende i parametri generali */
  SELECT FIRST 1
      COALESCE(FL_LOGO_INTESTAZIONE,'T'),
      COALESCE(FL_TITOLO,'T'),
      COALESCE(FL_DATI_PRESCRIZIONI,'T'),
      COALESCE(FL_DATI_CHIAMATA,'T'),
      COALESCE(FL_DATI_APPUNTAMENTO,'T'),
      COALESCE(FL_DATI_SOGGETTO,'T'),
      COALESCE(FL_DATI_SOGGETTO_NOTE,'T'),
      COALESCE(FL_DATI_RICHIEDENTE,'T'),
      COALESCE(FL_DATI_IMPIANTO,'T'),
      COALESCE(FL_DATI_ABBONAMENTO,'T'),
      COALESCE(FL_DATI_IMMOBILE,'T'),
      COALESCE(FL_DATI_RESPIMP,'T'),
      COALESCE(FL_DATI_PROP_UT_AMM,'F'),
      COALESCE(FL_DATI_PROPRIETARIO,'F'),
      COALESCE(FL_DATI_UTENTE,'F'),
      COALESCE(FL_DATI_INSTALLATORE,'F'),
      COALESCE(FL_DATI_IMPIANTO_NOTE,'T'),
      COALESCE(FL_DATI_APPARECCHI,'T'),
      COALESCE(FL_DATI_APPARECCHI_SEPARATI,'F'),
      COALESCE(FL_DATI_OP,'T'),
      COALESCE(FL_DATI_OP_SOLODAFARE,'F'),
      COALESCE(FL_DATI_PRECEDENTI,'T'),
      COALESCE(FL_DATI_NUMULTINTERV,3),
      COALESCE(FL_DATI_RAPPINT,'T'),
      COALESCE(FL_DATI_MERCE,'T'),
      COALESCE(FL_DATI_ALTRESPESE,'T'),
      COALESCE(FL_DATI_FIRME,'T'),
      COALESCE(FL_LOGO_PIEDE,'T'),
      COALESCE(FL_COPIE,1),

      COALESCE(FL_LABEL_APPUNTAMENTO,''),
      COALESCE(FL_LABEL_CHIAMATA,''),
      COALESCE(FL_LABEL_CLIENTE,''),
      COALESCE(FL_LABEL_RICHIEDENTE,''),
      COALESCE(FL_LABEL_LUOGO,''),
      COALESCE(FL_LABEL_MOTIVO,''),
      COALESCE(FL_LABEL_NOTE,''),

      COALESCE(FL_DATI_INTESTAZFATTURA,'F'),

      COALESCE(FL_MESSAGGIO,''),
      COALESCE(FL_MESSAGGIO_ALTEZZA,0),

      COALESCE(FL_DATI_RAPPINT_NUMRIGHEDATAORA,1),
      COALESCE(FL_DATI_RAPPINT_ALTEZZARELAZINT,100),
      COALESCE(FL_DATI_RAPPINT_STATO,'T')
  FROM PROGRESS
  INTO :FL_LOGO_INTESTAZIONE,
       :FL_TITOLO,
       :FL_DATI_PRESCRIZIONI,
       :FL_DATI_CHIAMATA,
       :FL_DATI_APPUNTAMENTO,
       :FL_DATI_SOGGETTO,
       :FL_DATI_SOGGETTO_NOTE,
       :FL_DATI_RICHIEDENTE,
       :FL_DATI_IMPIANTO,
       :FL_DATI_ABBONAMENTO,
       :FL_DATI_IMMOBILE,
       :FL_DATI_RESPIMP,
       :FL_DATI_PROP_UT_AMM,
       :FL_DATI_PROPRIETARIO,
       :FL_DATI_UTENTE,
       :FL_DATI_INSTALLATORE,
       :FL_DATI_IMPIANTO_NOTE,
       :FL_DATI_APPARECCHI,
       :FL_DATI_APPARECCHI_SEPARATI,
       :FL_DATI_OP,
       :FL_DATI_OP_SOLODAFARE,
       :FL_DATI_PRECEDENTI,
       :FL_DATI_NUMULTINTERV,
       :FL_DATI_RAPPINT,
       :FL_DATI_MERCE,
       :FL_DATI_ALTRESPESE,
       :FL_DATI_FIRME,
       :FL_LOGO_PIEDE,
       :FL_COPIE,

       :FL_LABEL_APPUNTAMENTO,
       :FL_LABEL_CHIAMATA,
       :FL_LABEL_CLIENTE,
       :FL_LABEL_RICHIEDENTE,
       :FL_LABEL_LUOGO,
       :FL_LABEL_MOTIVO,
       :FL_LABEL_NOTE,

       :FL_DATI_INTESTAZFATTURA,

       :FL_MESSAGGIO,
       :FL_MESSAGGIO_ALTEZZA,

       :FL_DATI_RAPPINT_NUMRIGHEDATAORA,
       :FL_DATI_RAPPINT_ALTEZZARELAZINT,
       :FL_DATI_RAPPINT_STATO;

  /* Carica il flag che indica se l'impianto deve usare dei sui parametri personalizzati */
  SELECT COALESCE(FL_USAPREDEFINITI,'T')
  FROM PRATICHE
  WHERE ID = :IN_IDPRATICA
  INTO :IMP_FL_USAPREDEFINITI;


  /* Se l'impianto deve usare i suoi parametri effettua la sostituzione */
  IF (IMP_FL_USAPREDEFINITI = 'F') THEN BEGIN
    SELECT COALESCE(FL_DATI_APPARECCHI,'T'),
           COALESCE(FL_DATI_APPARECCHI_SEPARATI,'F'),
           COALESCE(FL_DATI_OP,'T'),
           COALESCE(FL_DATI_OP_SOLODAFARE,'F'),
           COALESCE(FL_DATI_PRECEDENTI,'T'),
           COALESCE(FL_DATI_NUMULTINTERV,3),
           COALESCE(FL_DATI_RAPPINT,'T'),
           COALESCE(FL_DATI_MERCE,'T'),
           COALESCE(FL_DATI_ALTRESPESE,'T'),
           COALESCE(FL_DATI_FIRME,'T'),
           COALESCE(FL_COPIE,1)
    FROM PRATICHE
    WHERE ID = :IN_IDPRATICA
    INTO   :FL_DATI_APPARECCHI,
           :FL_DATI_APPARECCHI_SEPARATI,
           :FL_DATI_OP,
           :FL_DATI_OP_SOLODAFARE,
           :FL_DATI_PRECEDENTI,
           :FL_DATI_NUMULTINTERV,
           :FL_DATI_RAPPINT,
           :FL_DATI_MERCE,
           :FL_DATI_ALTRESPESE,
           :FL_DATI_FIRME,
           :FL_COPIE;
  END

  /* Ritorna il risultato ed esce */
  SUSPEND;
  EXIT;

END^

SET TERM ; ^


