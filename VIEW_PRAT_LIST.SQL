/* View: PRAT_LIST_VIEW, Owner: 1DR0GAT3 */

CREATE VIEW PRAT_LIST_VIEW (

    TIPO
   ,CODICE
   ,DESCRIZIONE
   ,NOME
   ,DATAAPERTURA
   ,DATACHIUSURA
   ,ID
   ,STATODESCRIZIONE
   ,RAGIONESOCIALE
   ,STATOFOREGROUND
   ,STATOBACKGROUND
   ,CLIENTE
   ,RAGSOC
   ,NOTE
   ,CATEGCANT1
   ,CATEGCANT2
   ,CATEGCANT3
   ,CATEGCANT4
   ,CATEGCANT5
   ,CATEGCANT6
   ,AGENTE
   ,AGENTE2
   ,AGENTE3
   ,AGENTE4
   ,IMMOBINDIRIZZO
   ,IMMOBLOCALITA
   ,IMMOBPROVINCIA
   ,IMMOBCAP
   ,COMMITDENOMINAZIONE
   ,PROPDENOMINAZIONE
   ,ALTRISOGGETTI
   ,JOLLY1
   ,JOLLY2
   ,JOLLY3
   ,JOLLY4
   ,JOLLY5
   ,JOLLY6
   ,JOLLY7
   ,JOLLY8
   ,JOLLY9
   ,JOLLY10
   ,JOLLY11
   ,JOLLY12
   ,JOLLY13
 
   /* Flags */
   ,EXIST_PRESCRIZIONI
   ,EXIST_URGENTI
   ,EXIST_CHIAMATE
   ,EXIST_CORRISPNOPAG
   ,EXIST_SCADSOFF

) AS

  SELECT 

    P.TIPO
   ,P.CODICE
   ,P.DESCRIZIONE
   ,P.NOME
   ,P.DATAAPERTURA
   ,P.DATACHIUSURA
   ,P.ID
   ,P.STATODESCRIZIONE
   ,CAST(C.RAGIONESOCIALE || '  (' || P.CLIENTE || ')' AS VARCHAR(80)) AS RAGIONESOCIALE
   ,P.STATOFOREGROUND
   ,P.STATOBACKGROUND
   ,P.CLIENTE
   ,C.RAGIONESOCIALE AS RAGSOC
   ,P.NOTE
   ,P.CATEGCANT1
   ,P.CATEGCANT2
   ,P.CATEGCANT3
   ,P.CATEGCANT4
   ,P.CATEGCANT5
   ,P.CATEGCANT6
   ,P.AGENTE
   ,P.AGENTE2
   ,P.AGENTE3
   ,P.AGENTE4
   ,CAST(P.IMMOBINDIRIZZO || ', ' || P.IMMOBNUMCIVICO AS VARCHAR(120)) AS IMMOBINDIRIZZO
   ,P.IMMOBLOCALITA
   ,P.IMMOBPROVINCIA
   ,P.IMMOBCAP
   ,P.COMMITDENOMINAZIONE
   ,P.PROPDENOMINAZIONE
   ,P.ALTRISOGGETTI
   ,P.JOLLY1
   ,P.JOLLY2
   ,P.JOLLY3
   ,P.JOLLY4
   ,P.JOLLY5
   ,P.JOLLY6
   ,P.JOLLY7
   ,P.JOLLY8
   ,P.JOLLY9
   ,P.JOLLY10
   ,P.JOLLY11
   ,P.JOLLY12
   ,P.JOLLY13

   /* Flags */
   ,(SELECT OUTVAL FROM IMPIANTI_PRESCRIZ_EXISTS(P.CODICE, P.DATAAPERTURA)) 	  AS EXISTS_PRESCRIZIONI
   ,(SELECT OUTVAL FROM IMPIANTI_URGENTI_EXISTS(P.CODICE, P.DATAAPERTURA))        AS EXISTS_URGENTI
   ,(SELECT OUTVAL FROM IMPIANTI_CHIAMATE_EXISTS(P.CODICE, P.DATAAPERTURA))       AS EXISTS_CHIAMATE
   ,(SELECT OUTVAL FROM IMPIANTI_CORRISPNOPAG_EXISTS(P.CODICE, P.DATAAPERTURA))   AS EXISTS_CORRISPNOPAG
   ,(SELECT OUTVAL FROM IMPIANTI_SCADSOFF_EXISTS(P.CODICE, P.DATAAPERTURA))   	  AS EXISTS_SCADSOFF

  FROM PRATICHE P
  LEFT JOIN CLIENTI C ON C.CODICE = P.CLIENTE

;
