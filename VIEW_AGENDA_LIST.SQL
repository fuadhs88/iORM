/* View: AGENDA_LIST_VIEW, Owner: 1DR0GAT3 */

CREATE VIEW AGENDA_LIST_VIEW (

   ID,
   PARENTID,
   EVENTMESSAGE,
   START_EVENT,
   FINISH_EVENT,
   LOCATION,
   RESOURCEID,
   EVENTTYPE,
   LABELCOLOR,
   OPTIONS,
   STATE,
   RECURRENCEINDEX,
   RECURENCEINFO,
   RAGSOCCLI,
   CLIENTE,
   PRATICA,
   DATAPRATICA1,
   IDPRATICA,
   TIPOIMPEGNO,
   REGISTRO,
   MASTER_ID,

   EXISTS_URGENTI,
   EXISTS_STAMPATO,
   EXISTS_PRESCRIZIONI

) AS

SELECT

   I.ID,
   I.PARENTID,
   I.EVENTMESSAGE,
   I.START_EVENT,
   I.FINISH_EVENT,
   I.LOCATION,
   I.RESOURCEID,
   I.EVENTTYPE,
   I.LABELCOLOR,
   I.OPTIONS,
   I.STATE,
   I.RECURRENCEINDEX,
   I.RECURENCEINFO,
   I.RAGSOCCLI,
   I.CLIENTE,
   I.PRATICA,
   I.DATAPRATICA1,
   I.IDPRATICA,
   I.TIPOIMPEGNO,
   I.REGISTRO,
   I.MASTER_ID,

   CAST(   (CASE WHEN (I.TIPOIMPEGNO<>'Intervento' AND I.URGENTE='T') THEN 'T' ELSE 'F' END)   AS CHAR(1)) AS EXISTS_URGENTI,

   I.STAMPATO AS EXISTS_STAMPATO,

   CAST(
     CASE
       WHEN (COALESCE(I.PRATICA,0) <> 0) THEN (SELECT OUTVAL FROM IMPIANTI_PRESCRIZ_EXISTS(I.PRATICA, I.DATAPRATICA1))
       WHEN (COALESCE(I.CLIENTE,0) <> 0) THEN (SELECT OUTVAL FROM SOGG_PRESCRIZ_EXISTS(I.CLIENTE))
       ELSE (SELECT OUTVAL FROM IMPEGNI_PRESCRIZ_EXISTS(I.ID))
     END
   AS CHAR(1)) AS EXISTS_PRESCRIZIONI

FROM IMPEGNI I
;
