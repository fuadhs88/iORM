
/* View: MAG_ART, Owner: 1DR0GAT3 */

CREATE VIEW MAG_ART (
  CODICEARTICOLO, 
  CODICEMAGAZZINO, 
  DATADOCUMENTO, 
  TIPO, 
  GIACENZA, 
  ORDINATO, 
  IMPEGNATO
) AS

    SELECT R.CODICEARTICOLO, R.CODICEMAGAZZINO, R.DATADOCUMENTO, CAST('M' AS CHAR(1)) AS TIPO, R.MAG_QTA AS GIACENZA, 0 AS ORDINATO, 0 AS IMPEGNATO
    FROM RIGHIPRV AS R
    WHERE R.MAG_CHIUSURA IS NULL
    AND R.CODICEARTICOLO IS NOT NULL
    AND R.CODICEMAGAZZINO IS NOT NULL


    UNION ALL


    SELECT M.CODICEARTICOLO, M.CODICEMAGAZZINO, CAST('01/01/1900' AS TIMESTAMP), CAST('C' AS CHAR(1)) AS TIPO, M.GIACENZA, 0 AS ORDINATO, 0 AS IMPEGNATO
    FROM MAGAZZINI AS M


    UNION ALL


    SELECT O.CODICEARTICOLO, O.CODICEMAGAZZINO, O.DATADOCUMENTO, CAST('M' AS CHAR(1)) AS TIPO, 0 AS GIACENZA, O.MAG_ORDINATO, 0 AS IMPEGNATO
    FROM RIGHIPRV AS O
    WHERE O.CODICEARTICOLO IS NOT NULL
    AND O.CODICEMAGAZZINO IS NOT NULL


    UNION ALL


    SELECT I.CODICEARTICOLO, I.CODICEMAGAZZINO, I.DATADOCUMENTO, CAST('M' AS CHAR(1)) AS TIPO, 0 AS GIACENZA, 0 AS ORDINATO, I.MAG_IMPEGNATO
    FROM RIGHIPRV AS I
    WHERE I.CODICEARTICOLO IS NOT NULL
    AND I.CODICEMAGAZZINO IS NOT NULL
;