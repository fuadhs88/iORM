CREATE PROCEDURE PARTITARIO_COMPONINOTADOCUMENTO (IN_TIPODOC VARCHAR(25), IN_REGDOC VARCHAR(5), IN_NUMDOC INTEGER, IN_DATADOC TIMESTAMP)
  RETURNS (OUTVAR VARCHAR(500))
AS
  DECLARE VARIABLE loc_descrizione VARCHAR(5000);
BEGIN

  OUTVAR = '';

  FOR SELECT FIRST 3 COALESCE(R.DESCRIZIONE,'') FROM RIGHIPRV R
    WHERE R.TIPODOCUMENTO = :IN_TIPODOC
    AND R.REGISTRO = :IN_REGDOC
    AND R.NUMORDPREV = :IN_NUMDOC
    AND R.DATADOCUMENTO = :IN_DATADOC
    AND COALESCE(R.DESCRIZIONE, '') <> ''
  INTO :loc_descrizione 
  DO BEGIN

    IF (TRIM(:loc_descrizione) <> '') THEN
      OUTVAR = OUTVAR || '- ' || SUBSTRING(:loc_descrizione FROM 1 FOR 98) || '
'; /* CR + LF */  

  END 

  SUSPEND;
  EXIT;

END
