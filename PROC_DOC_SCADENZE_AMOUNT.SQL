SET TERM ^ ;

CREATE PROCEDURE DOC_SCADENZE_AMOUNT (in_TipoDoc VARCHAR(25), in_RegDoc VARCHAR(5), in_NumDoc INTEGER, in_DataDoc TIMESTAMP)
RETURNS (OUTVAR DECIMAL(10,4))
AS
  DECLARE VARIABLE loc_Importo DECIMAL(10,4);
BEGIN

  OUTVAR = 0;

  FOR SELECT SUM(COALESCE(S.IMPORTO,0) - COALESCE(S.IMPORTOPAGATO,0)) FROM SCADENZ S WHERE S.TIPODOC = :in_TipoDoc AND S.REGISTRO = :in_RegDoc AND S.NUMDOC = :in_NumDoc AND S.DATADOC = :in_DataDoc
    INTO :loc_Importo 
  DO
  BEGIN
    OUTVAR = OUTVAR + COALESCE(:loc_Importo,0) ;
  END

  SUSPEND;

END^

SET TERM ; ^

