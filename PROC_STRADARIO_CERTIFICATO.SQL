SET TERM ^ ;

CREATE PROCEDURE STRADARIO_CERTIFICATO (IN_CODICECOMUNE VARCHAR(10), IN_DENOMINAZIONECOMUNE VARCHAR(60), IN_STRADA VARCHAR(80), IN_SIGLAPROVINCIA VARCHAR(3))
  RETURNS (OUTVAR CHAR(1))
AS
  DECLARE VARIABLE loc_DenominazioneComune VARCHAR(60);
  DECLARE VARIABLE loc_CodiceProvincia VARCHAR(10);
  DECLARE VARIABLE loc_SiglaProvincia VARCHAR(3);
BEGIN

  /* Inizializzazione */
  OUTVAR='F';

  /* Verifica codice comune e nome strada */
  IF (   NOT EXISTS(SELECT CAST('T' AS CHAR(1)) FROM STRADARIO_STRADE WHERE CODICEISTATCOMUNECOMPLETO=:IN_CODICECOMUNE AND DENOMINAZIONESTRADACOMPLETA=UPPER(:IN_STRADA))   ) THEN
  BEGIN
    SUSPEND;
    EXIT;
  END

  /* Verifica denominazione comune */
  SELECT DENOMINAZIONECOMUNE, CODICEISTATPROVINCIA FROM STRADARIO_COMUNI WHERE CODICEISTATCOMUNECOMPLETO=:IN_CODICECOMUNE
  INTO :loc_DenominazioneComune, :loc_CodiceProvincia;
  IF (:loc_DenominazioneComune<>UPPER(:IN_DENOMINAZIONECOMUNE)) THEN 
  BEGIN
    SUSPEND;
    EXIT;
  END

  /* Verifica sigla provincia */
  SELECT SIGLAPROVINCIA FROM STRADARIO_PROVINCE WHERE CODICEISTATPROVINCIA=:loc_CodiceProvincia
  INTO :loc_SiglaProvincia;
  IF (:loc_SiglaProvincia<>UPPER(:IN_SIGLAPROVINCIA)) THEN 
  BEGIN
    SUSPEND;
    EXIT;
  END

  /* Se arriva qui l'indirizzo è certificato */
  OUTVAR='T';
  SUSPEND;
  EXIT;

END^

SET TERM ; ^
